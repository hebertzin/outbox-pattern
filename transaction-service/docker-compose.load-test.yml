# Load-test overlay â€” extends the main docker-compose.yml.
#
# Usage (from transaction-service/):
#
#   # Start the full stack first:
#   docker compose up -d
#
#   # Then run the load test (exits when k6 finishes):
#   docker compose -f docker-compose.yml -f docker-compose.load-test.yml run --rm k6
#
#   # Or override the target URL if the service runs outside Docker:
#   BASE_URL=http://host.docker.internal:8080 \
#     docker compose -f docker-compose.yml -f docker-compose.load-test.yml run --rm k6

name: transaction-service

services:
  k6:
    image: grafana/k6:latest
    container_name: transaction-k6
    command: run /scripts/load-test.js
    environment:
      BASE_URL: ${BASE_URL:-http://app:8080}
      K6_OUT: ${K6_OUT:-}           # e.g. K6_OUT=influxdb=http://influx:8086/k6
    volumes:
      - ./tests/load:/scripts:ro
    depends_on:
      - app
    networks:
      - backend
